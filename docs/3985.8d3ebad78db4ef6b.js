"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3985],{3985:(S,h,a)=>{a.r(h),a.d(h,{IniciarSesionPageModule:()=>y});var v=a(177),f=a(4341),d=a(7125),m=a(4964),g=a(467),e=a(4438),P=a(1182),b=a(8079);const I=[{path:"",component:(()=>{var n;class c{constructor(t,r,o,i,l,s){this.router=t,this.afAuth=r,this.toastController=o,this.alertController=i,this.firestore=l,this.menu=s}ngOnInit(){this.verificarSesion()}verificarSesion(){var t=this;return(0,g.A)(function*(){const r=localStorage.getItem("userId");if(r)try{const o=yield t.firestore.collection("Usuarios").doc(r).get().toPromise();if(o&&o.exists){const i=o.data();t.redirigirPorRol(i.role)}}catch(o){console.error("Error al verificar sesi\xf3n:",o),localStorage.removeItem("userId")}})()}login(){var t=this;return(0,g.A)(function*(){const r=document.getElementById("email").value,o=document.getElementById("password").value,i=document.getElementById("recordarSesion").checked;if(r&&o)try{const s=(yield t.afAuth.signInWithEmailAndPassword(r,o)).user;if(s)if(s.emailVerified){const p=yield t.firestore.collection("Usuarios").doc(s.uid).get().toPromise();if(p&&p.exists){const x=p.data();i&&localStorage.setItem("userId",s.uid),t.redirigirPorRol(x.role)}else t.presentToast("Usuario no encontrado en la base de datos.","danger")}else t.presentToast("Por favor, verifica tu correo electr\xf3nico antes de iniciar sesi\xf3n.","danger")}catch(l){t.presentToast(l.message||"Error al iniciar sesi\xf3n.","danger")}else t.presentToast("Por favor, ingrese un correo y una contrase\xf1a v\xe1lidos","warning")})()}redirigirPorRol(t){"Editor"===t?this.router.navigate(["/menu-cotizador"]):"Aprobador/Editor"===t?this.router.navigate(["/home"]):"Generador solped"===t?this.router.navigate(["/menu-solpe"]):this.presentToast("No tiene un rol asignado. Contacte con soporte.","danger")}presentToast(t,r){var o=this;return(0,g.A)(function*(){(yield o.toastController.create({message:t,color:r,duration:3e3,position:"top"})).present()})()}resetPassword(t){var r=this;return(0,g.A)(function*(){var i;t.preventDefault(),yield(yield r.alertController.create({header:"Recuperar Contrase\xf1a",message:"Ingrese su correo electr\xf3nico para enviarle un enlace de recuperaci\xf3n.",inputs:[{name:"email",type:"email",placeholder:"Tu correo electr\xf3nico"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Enviar",handler:(i=(0,g.A)(function*(l){const s=l.email;if(s)try{yield r.afAuth.sendPasswordResetEmail(s),r.presentToast("Correo de recuperaci\xf3n enviado. Revisa tu bandeja de entrada.","success")}catch(p){r.presentToast(p.message||"Error al enviar el correo de recuperaci\xf3n.","danger")}else r.presentToast("Por favor, ingrese un correo v\xe1lido.","warning")}),function(s){return i.apply(this,arguments)})}]})).present()})()}goToRegister(t){t.preventDefault(),this.router.navigate(["/registrar-usuario"])}preventFormSubmit(t){t.preventDefault()}ionViewWillEnter(){this.menu.enable(!1)}}return(n=c).\u0275fac=function(t){return new(t||n)(e.rXU(m.Ix),e.rXU(P.DS),e.rXU(d.K_),e.rXU(d.hG),e.rXU(b.Qe),e.rXU(d._t))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-iniciar-sesion"]],decls:26,vars:0,consts:[[1,"form-control",3,"submit"],[1,"title"],[1,"input-field"],["required","","type","email","id","email",1,"input"],["for","email",1,"label"],["required","","type","password","id","password",1,"input"],["for","password",1,"label"],["type","checkbox","id","recordarSesion"],["for","recordarSesion"],["href","#",3,"click"],["type","button",1,"submit-btn",3,"click"],[1,"redirect-register"],[2,"color","var(--ion-color-primary)"]],template:function(t,r){1&t&&(e.j41(0,"ion-content")(1,"form",0),e.bIt("submit",function(i){return r.preventFormSubmit(i)}),e.j41(2,"p",1),e.EFF(3,"Bienvenido, inicia sesi\xf3n"),e.k0s(),e.j41(4,"div",2),e.nrm(5,"input",3),e.j41(6,"label",4),e.EFF(7,"Escribe tu email"),e.k0s()(),e.j41(8,"div",2),e.nrm(9,"input",5),e.j41(10,"label",6),e.EFF(11,"Escribe tu contrase\xf1a"),e.k0s()(),e.nrm(12,"br"),e.j41(13,"div",2),e.nrm(14,"input",7),e.j41(15,"label",8),e.EFF(16,"Recordar sesi\xf3n"),e.k0s()(),e.j41(17,"a",9),e.bIt("click",function(i){return r.resetPassword(i)}),e.EFF(18,"\xbfOlvidaste tu contrase\xf1a?"),e.k0s(),e.j41(19,"button",10),e.bIt("click",function(){return r.login()}),e.EFF(20,"Iniciar sesi\xf3n"),e.k0s(),e.j41(21,"div",11)(22,"p",12),e.EFF(23,"\xbfNo tienes una cuenta?"),e.k0s(),e.j41(24,"a",9),e.bIt("click",function(i){return r.goToRegister(i)}),e.EFF(25,"Reg\xedstrate aqu\xed"),e.k0s()()()())},dependencies:[f.qT,f.cb,f.cV,d.W9],styles:["ion-content[_ngcontent-%COMP%]{--background: #121212;display:flex;justify-content:center;align-items:center;height:100vh}.form-control[_ngcontent-%COMP%]{background-color:#1e1e1e;width:80%;max-width:400px;display:flex;flex-direction:column;padding:25px;border-radius:8px;margin-top:5%;margin-left:auto;margin-right:auto}.title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#fff;text-align:center}.input-field[_ngcontent-%COMP%]{position:relative;width:100%}.input[_ngcontent-%COMP%]{margin-top:15px;width:100%;outline:none;border-radius:8px;height:50px;border:none;background:#2a2a2a;padding-left:10px;color:#fff}.input[_ngcontent-%COMP%]:focus{border:1.5px solid rgb(87,189,132)}.label[_ngcontent-%COMP%]{position:absolute;top:20px;left:15px;color:#b0b0b0;transition:all .3s ease}.input[_ngcontent-%COMP%]:focus ~ .label[_ngcontent-%COMP%], .input[_ngcontent-%COMP%]:valid ~ .label[_ngcontent-%COMP%]{top:5px;left:10px;font-size:12px;color:#00c853}.submit-btn[_ngcontent-%COMP%]{margin-top:30px;height:50px;background:#57bd84;border-radius:12px;border:none;color:#fff;font-size:18px;font-weight:700;cursor:pointer;width:100%}.submit-btn[_ngcontent-%COMP%]:hover{background:#009624}.redirect-register[_ngcontent-%COMP%]{text-align:center;margin-top:15px}.redirect-register[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#57bd84;font-weight:700;text-decoration:none}.redirect-register[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.input-field[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:8px}"]}),c})()}];let C=(()=>{var n;class c{}return(n=c).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.iI.forChild(I),m.iI]}),c})(),y=(()=>{var n;class c{}return(n=c).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[v.MD,f.YN,d.bv,C]}),c})()}}]);